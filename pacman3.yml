- name: Provision ec2 instances based on the environment
  hosts: localhost
  connection: local
  gather_facts: True

  vars:
    fooble: "{{ hostvars['ec2_id'] }}"

  tasks:
    - name: Get instance tags
      ec2_tag:
        region: ap-southeast-2
        resource: "{{ fooble }}"
        state: present
        tags:
          Name: dbserver
          Env: production
